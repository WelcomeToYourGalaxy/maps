<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Embedded Content</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: #0a0a0a; overflow: hidden; }
    </style>
</head>
<body>
<!-- 
WEEBLY INSTRUCTIONS:
1. In Weebly editor, drag an "Embed Code" element onto your page
2. Click on it and select "Edit Custom HTML"
3. Copy and paste ALL of this code below
4. Save and publish
-->

<div id="tiva-map-container">
    <style>
        #tiva-map-container {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0a0a0f;
            color: #e8e8e8;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 24px rgba(0,0,0,0.3);
        }
        #tiva-map-container * { margin: 0; padding: 0; box-sizing: border-box; }
        
        .tiva-wrapper {
            display: flex;
            flex-direction: column;
        }
        
        @media (min-width: 900px) {
            .tiva-wrapper { flex-direction: row; height: 600px; }
            .tiva-sidebar { width: 380px; }
            .tiva-map-area { flex: 1; }
        }
        
        .tiva-sidebar {
            background: linear-gradient(180deg, #0d0d14 0%, #111118 100%);
            padding: 28px;
            border-bottom: 1px solid rgba(255,255,255,0.08);
        }
        
        @media (min-width: 900px) {
            .tiva-sidebar {
                border-bottom: none;
                border-right: 1px solid rgba(255,255,255,0.08);
                overflow-y: auto;
            }
        }
        
        .tiva-logo {
            font-size: 11px;
            font-weight: 600;
            letter-spacing: 2px;
            text-transform: uppercase;
            color: #6b7280;
            margin-bottom: 8px;
        }
        
        .tiva-title {
            font-size: 26px;
            font-weight: 700;
            line-height: 1.2;
            margin-bottom: 16px;
            color: #fff;
        }
        
        .tiva-subtitle {
            font-size: 14px;
            color: #9ca3af;
            line-height: 1.6;
            margin-bottom: 28px;
            padding-bottom: 24px;
            border-bottom: 1px solid rgba(255,255,255,0.06);
        }
        
        .tiva-subtitle strong { color: #fff; }
        
        .tiva-legend-section {
            margin-bottom: 28px;
        }
        
        .tiva-legend-title {
            font-size: 11px;
            font-weight: 600;
            letter-spacing: 1.5px;
            text-transform: uppercase;
            color: #6b7280;
            margin-bottom: 16px;
        }
        
        .tiva-legend-bar {
            height: 16px;
            border-radius: 8px;
            background: linear-gradient(90deg, #10b981 0%, #34d399 15%, #6ee7b7 30%, #fde047 50%, #fbbf24 60%, #f97316 75%, #ef4444 90%, #dc2626 100%);
            margin-bottom: 10px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.3);
        }
        
        .tiva-legend-labels {
            display: flex;
            justify-content: space-between;
            font-size: 11px;
            color: #9ca3af;
            margin-bottom: 12px;
        }
        
        .tiva-legend-desc {
            display: flex;
            gap: 20px;
            margin-bottom: 0;
        }
        
        .tiva-desc-item {
            flex: 1;
            padding: 12px;
            border-radius: 8px;
            font-size: 11px;
            line-height: 1.5;
        }
        
        .tiva-desc-item.green {
            background: rgba(16, 185, 129, 0.12);
            border: 1px solid rgba(16, 185, 129, 0.25);
            color: #6ee7b7;
        }
        
        .tiva-desc-item.red {
            background: rgba(239, 68, 68, 0.12);
            border: 1px solid rgba(239, 68, 68, 0.25);
            color: #fca5a5;
        }
        
        .tiva-desc-item strong { display: block; margin-bottom: 4px; font-weight: 600; }
        
        .tiva-info-panel {
            background: rgba(255,255,255,0.03);
            border: 1px solid rgba(255,255,255,0.08);
            border-radius: 12px;
            padding: 20px;
        }
        
        .tiva-info-panel h3 {
            font-size: 12px;
            font-weight: 600;
            letter-spacing: 1px;
            text-transform: uppercase;
            color: #6b7280;
            margin-bottom: 12px;
        }
        
        .tiva-info-panel p {
            font-size: 13px;
            line-height: 1.6;
            color: #9ca3af;
        }
        
        .tiva-info-panel .highlight-red { color: #f87171; font-weight: 600; }
        .tiva-info-panel .highlight-green { color: #34d399; font-weight: 600; }
        
        .tiva-map-area {
            position: relative;
            height: 500px;
        }
        
        @media (min-width: 900px) {
            .tiva-map-area { height: 100%; }
        }
        
        #tiva-map {
            width: 100%;
            height: 100%;
            background: #0a0a0f;
        }
        
        .tiva-source {
            position: absolute;
            bottom: 10px;
            left: 10px;
            font-size: 10px;
            color: rgba(255,255,255,0.5);
            background: rgba(0,0,0,0.7);
            padding: 6px 10px;
            border-radius: 4px;
            z-index: 1000;
        }
        
        .tiva-source a { color: #60a5fa; text-decoration: none; }
        
        .tiva-loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(13, 13, 20, 0.95);
            padding: 20px 30px;
            border-radius: 12px;
            border: 1px solid rgba(255,255,255,0.1);
            z-index: 1000;
            color: #9ca3af;
            font-size: 14px;
        }
        
        /* Leaflet overrides */
        #tiva-map-container .leaflet-tooltip {
            background: rgba(13, 13, 20, 0.95) !important;
            border: 1px solid rgba(255,255,255,0.15) !important;
            border-radius: 8px !important;
            padding: 8px 12px !important;
            color: #fff !important;
            font-size: 13px !important;
            font-weight: 500 !important;
            box-shadow: 0 4px 20px rgba(0,0,0,0.4) !important;
        }
        #tiva-map-container .leaflet-tooltip::before { display: none !important; }
        #tiva-map-container .leaflet-control-attribution {
            background: rgba(0,0,0,0.6) !important;
            color: rgba(255,255,255,0.6) !important;
            font-size: 9px !important;
        }
        #tiva-map-container .leaflet-control-attribution a { color: rgba(255,255,255,0.7) !important; }
    </style>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <div class="tiva-wrapper">
        <aside class="tiva-sidebar">
            <div class="tiva-logo">OECD TiVA Data 2020</div>
            <h2 class="tiva-title">Who Captures the Profits in Global Trade?</h2>
            <p class="tiva-subtitle">
                This map shows the <strong>Foreign Value Added</strong> share of each country's exports — 
                the percentage of export value that actually belongs to <em>other countries</em>.
            </p>
            
            <div class="tiva-legend-section">
                <div class="tiva-legend-title">Foreign Value Added in Exports</div>
                <div class="tiva-legend-bar"></div>
                <div class="tiva-legend-labels">
                    <span>0%</span>
                    <span>25%</span>
                    <span>50%</span>
                    <span>70%+</span>
                </div>
                <div class="tiva-legend-desc">
                    <div class="tiva-desc-item green">
                        <strong>□ Low FVA</strong>
                        Country keeps most profits from its exports
                    </div>
                    <div class="tiva-desc-item red">
                        <strong>□ High FVA</strong>
                        Other countries capture most of the value
                    </div>
                </div>
            </div>
            
            <div class="tiva-info-panel">
                <h3>What This Means</h3>
                <p>
                    When a country has <span class="highlight-red">high foreign value added</span>, 
                    it means they're doing work (like assembly) but the real profits 
                    go elsewhere. Countries with <span class="highlight-green">low foreign value added</span> 
                    capture more value from their own exports.
                </p>
            </div>
        </aside>
        
        <main class="tiva-map-area">
            <div id="tiva-map"></div>
            <div id="tiva-loading" class="tiva-loading">Loading country boundaries...</div>
            <div class="tiva-source">
                Data: <a href="https://www.oecd.org/en/topics/sub-issues/trade-in-value-added.html" target="_blank">OECD Trade in Value Added (TiVA) 2023 Edition</a> · Year: 2020
            </div>
        </main>
    </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
(function() {
    // All 76 countries - verified against OECD CSV data
    const D = {"MAR":{n:"Morocco",f:25.3,d:74.7},"LAO":{n:"Lao PDR",f:12.3,d:87.7},"IND":{n:"India",f:17.2,d:82.8},"KAZ":{n:"Kazakhstan",f:14.6,d:85.4},"IDN":{n:"Indonesia",f:11.2,d:88.8},"EGY":{n:"Egypt",f:8.0,d:92.0},"HKG":{n:"Hong Kong",f:20.8,d:79.2},"MYS":{n:"Malaysia",f:33.8,d:66.2},"JOR":{n:"Jordan",f:31.3,d:68.7},"MLT":{n:"Malta",f:60.9,d:39.1},"TUN":{n:"Tunisia",f:33.2,d:66.8},"VNM":{n:"Vietnam",f:48.0,d:52.0},"UKR":{n:"Ukraine",f:22.9,d:77.1},"AUS":{n:"Australia",f:9.4,d:90.6},"AUT":{n:"Austria",f:29.6,d:70.4},"BEL":{n:"Belgium",f:33.4,d:66.6},"CAN":{n:"Canada",f:22.8,d:77.2},"CHL":{n:"Chile",f:12.3,d:87.7},"COL":{n:"Colombia",f:11.4,d:88.6},"CRI":{n:"Costa Rica",f:15.9,d:84.1},"CZE":{n:"Czechia",f:37.7,d:62.3},"DNK":{n:"Denmark",f:33.8,d:66.2},"EST":{n:"Estonia",f:36.9,d:63.1},"FIN":{n:"Finland",f:29.7,d:70.3},"FRA":{n:"France",f:21.8,d:78.2},"DEU":{n:"Germany",f:21.4,d:78.6},"GRC":{n:"Greece",f:36.3,d:63.7},"HUN":{n:"Hungary",f:45.9,d:54.1},"ISL":{n:"Iceland",f:27.0,d:73.0},"IRL":{n:"Ireland",f:43.8,d:56.2},"ISR":{n:"Israel",f:16.0,d:84.0},"ITA":{n:"Italy",f:20.7,d:79.3},"JPN":{n:"Japan",f:13.3,d:86.7},"KOR":{n:"South Korea",f:29.7,d:70.3},"LVA":{n:"Latvia",f:24.1,d:75.9},"LTU":{n:"Lithuania",f:30.8,d:69.2},"LUX":{n:"Luxembourg",f:66.2,d:33.8},"MEX":{n:"Mexico",f:35.0,d:65.0},"NLD":{n:"Netherlands",f:30.2,d:69.8},"NZL":{n:"New Zealand",f:12.8,d:87.2},"NOR":{n:"Norway",f:16.6,d:83.4},"POL":{n:"Poland",f:28.9,d:71.1},"PRT":{n:"Portugal",f:29.7,d:70.3},"SVK":{n:"Slovakia",f:47.7,d:52.3},"SVN":{n:"Slovenia",f:33.1,d:66.9},"ESP":{n:"Spain",f:23.2,d:76.8},"SWE":{n:"Sweden",f:23.3,d:76.7},"CHE":{n:"Switzerland",f:22.2,d:77.8},"TUR":{n:"Turkey",f:21.6,d:78.4},"GBR":{n:"United Kingdom",f:14.3,d:85.7},"USA":{n:"United States",f:7.5,d:92.5},"ARG":{n:"Argentina",f:9.5,d:90.5},"BGD":{n:"Bangladesh",f:19.3,d:80.7},"BLR":{n:"Belarus",f:34.0,d:66.0},"BRA":{n:"Brazil",f:13.9,d:86.1},"BRN":{n:"Brunei",f:17.9,d:82.1},"BGR":{n:"Bulgaria",f:32.0,d:68.0},"KHM":{n:"Cambodia",f:35.1,d:64.9},"CMR":{n:"Cameroon",f:10.6,d:89.4},"CHN":{n:"China",f:15.8,d:84.2},"CIV":{n:"Côte d'Ivoire",f:8.4,d:91.6},"HRV":{n:"Croatia",f:21.5,d:78.5},"CYP":{n:"Cyprus",f:50.6,d:49.4},"MMR":{n:"Myanmar",f:14.8,d:85.2},"NGA":{n:"Nigeria",f:4.0,d:96.0},"PAK":{n:"Pakistan",f:10.9,d:89.1},"PER":{n:"Peru",f:10.6,d:89.4},"PHL":{n:"Philippines",f:22.3,d:77.7},"ROU":{n:"Romania",f:22.2,d:77.8},"RUS":{n:"Russia",f:9.5,d:90.5},"SAU":{n:"Saudi Arabia",f:4.4,d:95.6},"SEN":{n:"Senegal",f:21.2,d:78.8},"SGP":{n:"Singapore",f:43.8,d:56.2},"ZAF":{n:"South Africa",f:20.3,d:79.7},"TWN":{n:"Taiwan",f:32.4,d:67.6},"THA":{n:"Thailand",f:31.4,d:68.6}};
    
    function getColor(f) {
        if(f==null) return '#374151';
        if(f<10) return '#059669';
        if(f<15) return '#10b981';
        if(f<20) return '#34d399';
        if(f<25) return '#6ee7b7';
        if(f<30) return '#fde047';
        if(f<35) return '#fbbf24';
        if(f<40) return '#f97316';
        if(f<50) return '#ef4444';
        return '#dc2626';
    }
    
    function getISO3(p) {
        return p.ISO_A3||p.iso_a3||p.ADM0_A3||p.adm0_a3||p.ISO3||p.iso3||null;
    }
    
    function getName(p) {
        return p.ADMIN||p.admin||p.NAME||p.name||p.NAME_LONG||'Unknown';
    }
    
    const loadingEl = document.getElementById('tiva-loading');
    
    const map = L.map('tiva-map',{center:[20,0],zoom:2.5,minZoom:2,maxZoom:8,worldCopyJump:true});
    
    L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}',{attribution:'Tiles &copy; Esri'}).addTo(map);
    
    let geoLayer;
    
    function style(feature) {
        const iso3 = getISO3(feature.properties);
        const data = D[iso3];
        const f = data ? data.f : null;
        return {fillColor:getColor(f),weight:1,opacity:0.8,color:'rgba(255,255,255,0.3)',fillOpacity:f!==null?0.75:0.15};
    }
    
    function highlight(e) {
        const layer = e.target;
        layer.setStyle({weight:2,color:'#fff',fillOpacity:0.9});
        layer.bringToFront();
    }
    
    function reset(e) {
        geoLayer.resetStyle(e.target);
    }
    
    function onEach(feature, layer) {
        const iso3 = getISO3(feature.properties);
        const data = D[iso3];
        const name = data ? data.n : getName(feature.properties);
        if(data) {
            layer.bindTooltip(name+': '+data.f+'% foreign', {permanent:false,direction:'top'});
        } else {
            layer.bindTooltip(name, {permanent:false,direction:'top'});
        }
        layer.on({mouseover:highlight,mouseout:reset});
    }
    
    const urls = [
        'https://raw.githubusercontent.com/nvkelso/natural-earth-vector/master/geojson/ne_110m_admin_0_countries.geojson',
        'https://raw.githubusercontent.com/datasets/geo-countries/master/data/countries.geojson'
    ];
    
    async function loadGeo() {
        for(const url of urls) {
            try {
                const res = await fetch(url);
                if(!res.ok) continue;
                const data = await res.json();
                if(data && data.features && data.features.length > 0) {
                    loadingEl.style.display = 'none';
                    geoLayer = L.geoJSON(data,{style:style,onEachFeature:onEach}).addTo(map);
                    return;
                }
            } catch(e) { console.warn('Failed:',url); }
        }
        loadingEl.innerHTML = 'Failed to load country boundaries.<br>Please refresh the page.';
        loadingEl.style.color = '#f87171';
    }
    
    loadGeo();
})();
</script>
</body>
</html>